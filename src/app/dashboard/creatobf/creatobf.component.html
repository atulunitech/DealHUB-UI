<form [formGroup]="_obfservices.ObfCreateForm">

  <div fxLayout="row" fxLayoutAlign="space-between center"  class="filter_cont creat_bof_con" >
      <div fxLayout="row" fxLayoutAlign="start center" class="creat_obf_tit">
          <div class="back_rout" routerLink="/DealHUB/dashboard"><img src="assets/images/arrow_icon.png">Back</div>
          <!-- <div class="back_rout" routerLink="/DealHUB/dashboard">Go Back</div> -->
      <div class="com_title conm_title_obf">{{editorcreateobfstring}}</div>
  </div>
  
  <div>
    <div fxLayout="row" fxLayoutAlign="start center" class="creat_obf_tit">
      <div class="back_rout" routerLink="/DealHUB/dashboard">Close</div>
    </div>
  </div>
      
   </div>
   <div  fxLayout="column" fxLayoutAlign=" none"  class="filter_cont obf_form_cont">
      <div class="cust-accor">
          <mat-accordion>
            <!-- (opened)="panelOpenState = true" (closed)="panelOpenState = false" -->
                <mat-expansion-panel  [expanded]="step === 0" (afterExpand)="removeandaddvalidation('upload')" (opened)="setStep(0)" >
                  <mat-expansion-panel-header collapsedHeight="50px" expandedHeight="50px">
                    <mat-panel-title>
                      1/3 Upload Document <span class="is_done" [class.is_done_not]="!uploadnotdisabled"><img src="assets/images/active_tick.png" style="display: inline-block;
                        margin-left: 20px;"></span>
                    </mat-panel-title>
                    
                  </mat-expansion-panel-header>
                  <div class="mat_exp_wrp">
                    <!-- <div class="mat_exp_title">Enter details to create OBF</div> -->
                    <div fxLayout="column" fxLayoutAlign=" none" class="mat_fld_box_wrp">
                     
          
                      <div fxLayout="row" fxLayoutAlign="space-between start"  class="mat_fld_box_wrp con_dwn_wrp">
                        <div fxFlex="auto " fxLayoutAlign="space-between center" class="mat_upload_box" >
                          <div fxFlex="auto " class="mat_upload_in_wr">
                            <div class="mat_upload_tit" *ngIf="!isppl" >
                              Attach OBF SHEET <div class="info_view">i
                                <div class="hov_info">
                                  <div class="infopop_title">OBF Sheet file instructions</div>
                                  <ul class="infopop_discrip">
                                    <li> In excel workbook should be in specified standard template.</li>
                                    <li> Workbook name should be “OBF Coversheet”.</li>
                                    <li> All mandatory fields should have values.</li>
                                    <li> Verticals can be Auto and Engineering,E-Commerce,Consumer and Pharma,Auto Outbound,
                                      Enterprise Mobility,Mahindra and Mahindra,MLL Network,Consumer - Telecom.</li>
                                      <li> Value of Total cost, Revenue and Capex should be in Crores.</li>
                                      <li>Payment terms should be entered in days.</li>
                                      <li>Total Project Life to be entered in number of months.</li>
                                      <li>For Verticals Enterprise Mobility, MLL Network and Transport Solution Group, Project type can only be Transportation.</li>
                                      <li> Please check before submitting for all entered values.</li>
                                  </ul>
                                </div>
                               
                              </div>
                            </div>
                            <div class="mat_upload_tit" *ngIf="isppl" >
                              Attach PPL SHEET <div class="info_view">i
                                <div class="hov_info" >
                                  <div class="infopop_title">PPL Sheet file instructions</div>
                                  <ul class="infopop_discrip">
                                    <li> ­­­­In excel, workbook should be in specified standard template.</li>
                                    <li> Workbook name should be "PPL Coversheet".</li>
                                    <li> All mandatory fields should have values.</li>
                                    <li> Verticals can be Auto and Engineering,E-Commerce,Consumer and Pharma,Auto Outbound,
                                      Enterprise Mobility,Mahindra and Mahindra,MLL Network,Consumer - Telecom.</li>
                                      <li> Value of Total cost, Revenue and Capex should be in Crores.</li>
                                      <li>Payment terms should be entered in days.</li>
                                      <li>Total Project Life to be entered in number of months.</li> 
                                      <li>For Verticals Enterprise Mobility, MLL Network and Transport Solution Group, Project type can only be Transportation.</li>
                                      <li>For PPL fields like Project Name, Project Type, Customer Name, Opportunity ID, Project Primary Location/ State, Vertical must be same as that of final Approved OBF version.</li>
                                      <li> Please check before submitting for all entered values.</li>
                                  </ul>
                                </div>
                               
                              </div>
                            </div>
                            <ngx-dropzone class="mat_up_con" (change)="onSelect($event,'coversheet')" accept=".xlsx">
                              <ngx-dropzone-label class="matUp_lable">
                                <div><img src="assets/images/Group Upload.png"></div>
                                <div class="drap_titl">
                                  Drag & Drop
                                  <div class="in_titl">Or select file from your system</div>
                                </div>
                                
                              </ngx-dropzone-label>
                             
                                <!-- <div>
                                  kja;lfj ;
                                </div> -->
                            </ngx-dropzone>
                            <div class="bt_uplad_con">
                              <div class="cr_corner"><img src="assets/images/fold_icon.png"></div>
                              <button [disabled]="!(coversheetfiles.length >0) || iscoversheet" (click)="uploadfiles(coversheetfiles,'coversheet')" class="creat_bt" mat-flat-button>Upload</button>
                            </div>
                            <!-- <input [disabled]="!(coversheetfiles.length >0)" class="btn btn-primary" (click)="uploadfiles(coversheetfiles,'coversheet')" type="button" value="Upload"/> -->
                            <div class="mat_upload_tit" style="margin-top: 36px;" *ngIf="!isppl &&(coversheetfiles.length > 0 || (editObfcoverbol && _obfservices.coversheetarray.length > 0))">
                              Uploaded Attach Obf Sheet 
                             </div>
                             <div class="mat_upload_tit" style="margin-top: 36px;" *ngIf="isppl &&(coversheetfiles.length > 0 || (editObfcoverbol && _obfservices.coversheetarray.length > 0))">
                              Uploaded PPL Sheet 
                             </div>
                            <div *ngIf="Coversheetprogress.length == 0">
                              
                            <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of coversheetfiles" [removable]="true" (removed)="onRemove(coversheetfiles,f,'coversheet')">
                              
                              <ngx-dropzone-label class="drop_lab_cs">
                                <div class="doc_icon">
                                  <img src="assets/images/doc_icon.JPG" style="margin-right: 15px;">
                                </div>
                                <div class="doc_cont" *ngIf="Coversheetprogress.length == 0">
                                  {{ f.name }}
                                 

                                </div> 
                                
                              </ngx-dropzone-label>
                            </ngx-dropzone-preview>
                          </div>
                          <div *ngIf="Coversheetprogress.length > 0">
                            
                            <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of Coversheetprogress" [removable]="true" (removed)="removeprogresscoversheet()">
                              
                              <ngx-dropzone-label class="drop_lab_cs">
                                <div style="background-color: #2258bf;position: absolute;width: 100%;height: 100%;top: 0;opacity: 0.5;left: 0px;border-radius: 5px;" [style.width.%]="f.value"></div>
                                <div class="doc_icon" >
                                  <img src="assets/images/tick.png" style="margin-right: 15px;">
                                </div>
                                <div class="doc_cont" style="position: relative;" >
                                  {{ f.fileName }}
                                

                                </div> 
                                
                              </ngx-dropzone-label>
                            </ngx-dropzone-preview>
                          </div>
                          <div *ngIf="editObfcoverbol && _obfservices.coversheetarray.length > 0">
                            
                            <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of _obfservices.coversheetarray" [removable]="true" (removed)="removeeditcoversheet()">
                              
                              <ngx-dropzone-label class="drop_lab_cs">
                                <div style="background-color: #2258bf;position: absolute;width: 100%;height: 100%;top: 0;opacity: 0.5;left: 0px;border-radius: 5px;"></div>
                                <div class="doc_icon" >
                                  <img src="assets/images/tick.png" style="margin-right: 15px;">
                                </div>
                                <div class="doc_cont" style="position: relative;" >
                                  {{ f._fname }}
                                

                                </div> 
                                
                              </ngx-dropzone-label>
                            </ngx-dropzone-preview>
                          </div>
                           
                            </div>
                            
                          <!-- <div *ngIf="message.length" class="alert alert-secondary my-3" role="alert">
                            <ul *ngFor="let msg of message; let i = index">
                              <li>{{ msg }}</li>
                            </ul>
                          </div> -->
                        </div>
                        <div fxFlex="auto " fxLayoutAlign="space-between center" class="mat_upload_box" >
                          <div fxFlex="auto " class="mat_upload_in_wr">
                            <div class="mat_upload_tit">
                              LOI/PO/Agreement or Self Declaration 
                            </div>
                            <ngx-dropzone class="mat_up_con" (change)="onSelect($event,'loipo')" accept=".xlsx,.xls,.pdf,.jpeg,.png,.doc,.docx,.csv,.JPG" [disabled]="loiopdisabled">
                              <ngx-dropzone-label class="matUp_lable">
                                <div><img src="assets/images/Group Upload.png"></div>
                                <div class="drap_titl">
                                  Drag & Drop
                                  <div class="in_titl">Or select file from your system</div>
                                </div>
                                
                              </ngx-dropzone-label>
                             
                              
                            </ngx-dropzone>
                            <div class="bt_uplad_con" >
                              <div class="cr_corner"><img src="assets/images/fold_icon.png"></div>
                              <div class="mt-cust-fd upl_sec_cut" style="    position: absolute;
                              right: 125px;">
                                
                                <mat-form-field appearance="fill" class="example-full-width">
                                  <mat-label>Select Type</mat-label>
                                  <mat-select formControlName="Loipodropdown" [disabled]="loiopdisabled" disableOptionCentering>
                                    <mat-option value="PO"  >
                                      PO
                                    </mat-option>
                                    <mat-option value="LOI">
                                      LOI
                                    </mat-option>
                                    <mat-option value="Agreement">
                                      Agreement
                                    </mat-option>
                                  </mat-select>
                                </mat-form-field>
                              </div>
                              <button [disabled]="!(loipofiles.length >0) || isloipo" (click)="uploadfiles(loipofiles,'loipo')" class="creat_bt" mat-flat-button>Upload</button>
                           <!-- <input type="button" [disabled]="!(loipofiles.length >0)" class="btn btn-primary" (click)="uploadfiles(loipofiles,'loipo')" value="Upload"/>  -->
                            </div>
                            <div style="margin-top: 5px;position: relative;">
                             <div class="cus_check">
                                <mat-checkbox  class="example-margin" formControlName="Selfdeclare" name="selfdec"  (change)="onCheckboxChange($event)" id="selfdec" value="self">{{declarations}} </mat-checkbox>
                              </div> 
                              <!-- <input type="checkbox" formControlName="Selfdeclare" name="selfdec" value="selfdeclared" (change)="onCheckboxChange($event)" id="selfdec" value="self" />
                              <label for="selfdec">This OBF is without LOI / PO </label><br>   -->
                            </div>
                            <div class="mat_upload_tit" style="margin-top: 7px;position: relative;" *ngIf="loipofiles.length > 0 || (editObfcoverbol && _obfservices.loipoarray.length > 0)">
                              Uploaded Loi/Po Agreement 
                             </div>
                             <div *ngIf="LoiPoprogress.length == 0">
                            <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of loipofiles" [removable]="true" (removed)="onRemove(loipofiles,f,'loipo')">
                              
                              <ngx-dropzone-label class="drop_lab_cs">
                                <div class="doc_icon">
                                  <img src="assets/images/doc_icon.JPG" style="margin-right: 15px;">
                                </div>
                                <div class="doc_cont">
                                  {{ f.name }}
                                 <!-- <div>{{ f.type }}</div>  -->

                                </div> 
                              </ngx-dropzone-label>
                            </ngx-dropzone-preview>
                            </div>
                            <div *ngIf="LoiPoprogress.length > 0">
                              <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of LoiPoprogress" [removable]="true" (removed)="onRemoveLoiPoPreview(f,LoiPoprogress)">
                                
                                <ngx-dropzone-label class="drop_lab_cs">
                                  <div style="background-color: #2258bf;position: absolute;width: 100%;height: 100%;top: 0;opacity: 0.5;left: 0px;border-radius: 5px;" [style.width.%]="f.value"></div>
                                  <div class="doc_icon">
                                    <img src="assets/images/tick.png" style="margin-right: 15px;">
                                  </div>
                                  <div class="doc_cont" style="position: relative;" >
                                    {{ f.fileName }}
                                   
  
                                  </div>  
                                </ngx-dropzone-label>
                              </ngx-dropzone-preview>
                              </div>
                              <div *ngIf="editObfLoiPobol && _obfservices.loipoarray.length > 0">
                            
                                <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of _obfservices.loipoarray" [removable]="true" (removed)="onRemoveLoiAttachments()" >
                                  
                                  <ngx-dropzone-label class="drop_lab_cs">
                                    <div style="background-color: #2258bf;position: absolute;width: 100%;height: 100%;top: 0;opacity: 0.5;left: 0px;border-radius: 5px;"></div>
                                    <div class="doc_icon" >
                                      <img src="assets/images/tick.png" style="margin-right: 15px;">
                                    </div>
                                    <div class="doc_cont" style="position: relative;" >
                                      {{ f._fname }}
                                    
    
                                    </div> 
                                    
                                  </ngx-dropzone-label>
                                </ngx-dropzone-preview>
                              </div>
                            </div>
                          </div>
                          <div fxFlex="auto " fxLayoutAlign="space-between center" class="mat_upload_box" >
                            <div fxFlex="auto " class="mat_upload_in_wr">
                               <!-- <div class="mat_upload_tit">
                                <div class="cus_check">
                                <mat-checkbox  class="example-margin" (change)="Supportcheckboxchange($event)" [checked]="checked_d" [(ngModel)]="checked_d">Supporting Document</mat-checkbox>
                              </div>
                              </div> -->
                              <div class="mat_upload_tit">
                                Supporting Document
                              </div>
                              <!-- <ngx-dropzone class="mat_up_con" (change)="onSelect($event,'support')" accept=".xlsx,.xls,.pdf,.jpeg,.png,.doc,.docx,.csv" [disabled]="supportchecked"> -->
                                <ngx-dropzone class="mat_up_con" (change)="onSelect($event,'support')" accept=".xlsx,.xls,.pdf,.jpeg,.png,.doc,.docx,.csv,.msg,.JPG" >
                              <ngx-dropzone-label class="matUp_lable">
                                <div><img src="assets/images/Group Upload.png"></div>
                                <div class="drap_titl">
                                  Drag & Drop
                                  <div class="in_titl">Or select file from your system</div>
                                </div>
                                
                              </ngx-dropzone-label>
                             
                            </ngx-dropzone>
                            <div class="bt_uplad_con">
                              <div class="cr_corner"><img src="assets/images/fold_icon.png"></div>
                              <button [disabled]="!(supportfiles.length >0) || isSupport" (click)="uploadfiles(supportfiles,'support')" class="creat_bt" mat-flat-button>Upload</button>
                              
                            </div>
                            <div class="mat_upload_tit" style="margin-top: 36px;" *ngIf="supportfiles.length > 0 || (SupportPoprogress.length > 0) || (editObfcoverbol && _obfservices.supportarray.length > 0)">
                              Uploaded Supporting Documents 
                             </div>
                          <div *ngIf="SupportPoprogress.length == 0">
                            <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of supportfiles" [removable]="true" (removed)="onRemove(supportfiles,f,'support')">
                              
                              <ngx-dropzone-label class="drop_lab_cs">
                                <div class="doc_icon">
                                  <img src="assets/images/doc_icon.JPG" style="margin-right: 15px;">
                                </div>
                                <div class="doc_cont">
                                  {{ f.name }}
                                 <!-- <div>{{ f.type }}</div>  -->

                                </div> 
                              </ngx-dropzone-label>
                            </ngx-dropzone-preview>
                          </div>  
                          <div *ngIf="SupportPoprogress.length > 0">
                            <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of supportfiles" [removable]="true" (removed)="onRemove(supportfiles,f,'support')">
                              
                              <ngx-dropzone-label class="drop_lab_cs">
                                <div class="doc_icon">
                                  <img src="assets/images/doc_icon.JPG" style="margin-right: 15px;">
                                </div>
                                <div class="doc_cont">
                                  {{ f.name }}
                                 <!-- <div>{{ f.type }}</div>  -->

                                </div> 
                              </ngx-dropzone-label>
                            </ngx-dropzone-preview>
                            <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of finalsupportarray" [removable]="true" (removed)="onRemoveAttachmentsPreview(f,finalsupportarray)" >
                              
                              <ngx-dropzone-label class="drop_lab_cs">
                                <div style="background-color: #2258bf;position: absolute;width: 100%;height: 100%;top: 0;opacity: 0.5;left: 0px;" [style.width.%]="f.value"></div>
                                <div class="doc_icon">
                                  <img src="assets/images/tick.png" style="margin-right: 15px;">
                                </div>
                                <div class="doc_cont" style="position: relative;" >
                                  {{ f.fileName }}
                                 

                                </div> 
                              </ngx-dropzone-label>
                            </ngx-dropzone-preview>
                          </div>   
                          <div *ngIf="editObfSupportbol && _obfservices.supportarray.length > 0">
                            
                            <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of _obfservices.supportarray" [removable]="true" (removed)="onRemoveAttachments(f,_obfservices.supportarray)">
                              
                              <ngx-dropzone-label class="drop_lab_cs">
                                <div style="background-color: #2258bf;position: absolute;width: 100%;height: 100%;top: 0;opacity: 0.5;left: 0px;border-radius: 5px;"></div>
                                <div class="doc_icon" >
                                  <img src="assets/images/tick.png" style="margin-right: 15px;">
                                </div>
                                <div class="doc_cont" style="position: relative;" >
                                  {{ f._fname }}
                                

                                </div> 
                                
                              </ngx-dropzone-label>
                            </ngx-dropzone-preview>
                          </div> 
                              </div>
                         </div>
                         
                          
                          </div>
                      <div class="mat_exp_fot" fxLayout="row" fxLayoutAlign="space-between center">
                         <div class="mat_fot_drf" >
                          <!-- <button mat-flat-button  class="creat_bt mat_fot_bt" [disabled]="_obfservices.ObfCreateForm.invalid" (click)="Saveasdraft('upload')">SAVE AS DRAFT</button> -->
                        </div> 
                        <div class="mat_fot_drf" >
                          
                          <button mat-flat-button class="creat_bt" [disabled]="!uploadnotdisabled" (click)="nextStep('details')">
                            NEXT
                          </button>
                        </div>
                        
                          </div>
                    </div>
                  </div>
                 
                </mat-expansion-panel>
                <!--  -->
                <mat-expansion-panel   [expanded]="step === 1" (afterExpand)="removeandaddvalidation('details')" (opened)="setStep(1)">
                  <mat-expansion-panel-header collapsedHeight="50px" expandedHeight="50px">
                    <mat-panel-title>
                      {{isppl?'2/3 PPL Details ':'2/3 Enter Details '}}
                       <span class="is_done" [class.is_done_not]="detailstickdisabled"><img src="assets/images/active_tick.png" style="display: inline-block;
                        margin-left: 55px;"></span>
                    </mat-panel-title>
                    
                  </mat-expansion-panel-header>
                  <div class="mat_exp_wrp">
                    <div class="mat_exp_title">Enter details to create {{isppl?'PPL':'OBF'}} </div>
                    <div fxLayout="column" fxLayoutAlign=" none" class="mat_fld_box_wrp">
                      <div fxLayout="row" fxLayoutAlign="space-between center">
                        <div fxLayout="row" fxLayoutAlign="space-between center" fxFlex="50">
                          <div class="mat_fld_box_in" fxFlex="50">
                            <div class="mt-cust-fd" fxFlex="1 1 100%">
                              <mat-form-field appearance="fill" class="example-full-width">
                                <mat-label>Select solution category *</mat-label>
                    <mat-select  formControlName="Solutioncategory"  [errorStateMatcher]="matcher" disableOptionCentering>
                      <mat-option *ngFor="let Solution of Solutiongroup" [disabled]="reinitiatefordisable" [value]="Solution.value"  (onSelectionChange)="onchange($event,Solution.Solutioncategory)">

                        {{Solution.Solutioncategory}}
                      </mat-option>
                      
                    </mat-select>
                    <mat-error *ngIf="_obfservices.ObfCreateForm.controls.Solutioncategory.errors?.required">
                      Solution Category is <strong>required</strong>
                    </mat-error>
                              </mat-form-field>
                            </div>
                          </div>
                          <div class="mat_fld_box_in" fxFlex="50">
                            <div class="mt-cust-fd" fxFlex="1 1 100%">
                              <mat-form-field appearance="fill" class="example-full-width">
                                <mat-label>Select type of service/solution category *</mat-label>
                                <mat-select [formControl]="servicesControl"  [errorStateMatcher]="matcher" multiple disableOptionCentering >
                                  <!-- <mat-option>-- None --</mat-option> -->
                                  <mat-optgroup *ngFor="let group of Solutionservicesarray" [label]="group.Solutioncategory"
                                                >
                                    <mat-option *ngFor="let list of group.Serviceslist" [disabled]="reinitiatefordisable"   (onSelectionChange)="onotherservicesoptionchange($event,list.viewValue,group.Solutioncategory,group.value)" [value]="list.value">
                                      {{list.viewValue}} 
                                    </mat-option>
                                  </mat-optgroup>
                                </mat-select>
                                <mat-error *ngIf="servicesControl.hasError('required')">
                                  Services is <strong>required</strong>
                                </mat-error>
                              </mat-form-field>
                            </div>
                          </div>
                        </div>
                        <div fxLayout="row" fxLayoutAlign="space-between center" fxFlex="50">
                          <div class="mat_fld_box_in" fxFlex="1 1 100%">
                            <div class="mt-cust-fd">
                              <mat-form-field appearance="fill" class="example-full-width">
                                <mat-label>Other Services</mat-label>
                                <input matInput formControlName="otherservices" [disabled]="reinitiatefordisable" id="abc" #otherservices style="margin-left: 10px;" (change)="otherssave($event,'services')" [errorStateMatcher]="matcher" required/>
                                <mat-error *ngIf="_obfservices.ObfCreateForm.controls.otherservices.errors?.required">
                                  Services:Other is <strong>required</strong>
                                </mat-error>
                                <mat-error *ngIf="_obfservices.ObfCreateForm.controls.otherservices.errors?.invalidservices">
                                  Special characters are not allowed
                                </mat-error>
                              </mat-form-field>
                            </div>
                          </div>
                          
                          <div class="mat_fld_box_in" fxFlex="1 1 100%">
                            <div class="mt-cust-fd">
                              <mat-form-field appearance="fill" class="example-full-width">
                                <mat-label>Other Solutions</mat-label>
                                <input matInput formControlName="othersolutions" [disabled]="reinitiatefordisable" style="margin-left: 10px;" (change)="otherssave($event,'solution')" [errorStateMatcher]="matcher" required/>
                                <mat-error *ngIf="_obfservices.ObfCreateForm.controls.othersolutions.errors?.required">
                                  Solution:Other is <strong>required</strong>
                                </mat-error>
                                <mat-error *ngIf="_obfservices.ObfCreateForm.controls.othersolutions.errors?.invalidservices">
                                  Special characters are not allowed
                                </mat-error>
                                </mat-form-field>
                            </div>
                          </div>
                          <div class="mat_fld_box_in" fxFlex="1 1 100%">
                            <div class="mt-cust-fd">
                              <mat-form-field appearance="fill" class="example-full-width">
                                <mat-label>Other Integrated Solutions</mat-label>
                                  <input matInput formControlName="otherintegratedsolutions" [disabled]="reinitiatefordisable" style="margin-left: 10px;" (change)="otherssave($event,'integratedsolution')" [errorStateMatcher]="matcher" required/>
                                  <mat-error *ngIf="_obfservices.ObfCreateForm.controls.otherintegratedsolutions.errors?.required">
                                    Integrated Solution:Other is <strong>required</strong>
                                  </mat-error>
                                  <mat-error *ngIf="_obfservices.ObfCreateForm.controls.otherintegratedsolutions.errors?.invalidservices">
                                    Special characters are not allowed
                                  </mat-error>
                                </mat-form-field>
                            </div>
                          </div>
                        </div>
                      </div>
          
                      <div fxLayout="row" fxLayoutAlign="start">
                        <div fxLayout="row" fxLayoutAlign="space-between center" fxFlex="50">
                          <div class="mat_fld_box_in" fxFlex="1 1 100%">
                            <div class="mt-cust-fd">
                              <mat-form-field appearance="fill" class="example-full-width">
                                <mat-label>Vertical *</mat-label>
                                  <input matInput formControlName="Vertical" [readonly]="true" />
                                </mat-form-field>
                            </div>
                          </div>
                          
                          <div class="mat_fld_box_in" fxFlex="50">
                            <div class="mt-cust-fd" fxFlex="1 1 100%">
                              <mat-form-field appearance="fill" class="example-full-width">
                                <mat-label>Select Sector *</mat-label>
                                <mat-select (selectionChange)="onsectorchange($event)" [errorStateMatcher]="matcher" formControlName="Sector" disableOptionCentering>
                                  <mat-option *ngFor="let Sector of sectorlist" [disabled]="reinitiatefordisable" [value]="Sector.value"  >
                                    {{Sector.viewValue}}
                                  </mat-option>
                                </mat-select>
                                <mat-error *ngIf="_obfservices.ObfCreateForm.controls.Sector.errors?.required">
                                  Sector is <strong>required</strong>
                                </mat-error>
                              </mat-form-field>
                            </div>
                          </div>
                          
                        </div>
                        <div fxLayout="row" fxLayoutAlign="space-between center" fxFlex="25">
                          <div class="mat_fld_box_in" fxFlex="100">
                            <div class="mt-cust-fd" fxFlex="1 1 100%">
                              <mat-form-field appearance="fill" class="example-full-width">
                                <mat-label>Select Sub Sector</mat-label>
                                <mat-select (selectionChange)="onsubsectorchange($event)" [errorStateMatcher]="matcher" formControlName="Subsector" disableOptionCentering>
                                  <mat-option *ngFor="let Subsector of subsectorlisdisplay" [disabled]="reinitiatefordisable" [value]="Subsector.value"  >
                                    {{Subsector.viewValue}}
                                  </mat-option>
                                </mat-select>
                                <mat-error *ngIf="_obfservices.ObfCreateForm.controls.Subsector.errors?.required">
                                  Subsector is <strong>required</strong>
                                </mat-error>
                              </mat-form-field>
                            </div>
                          </div>
                          
                        
                        </div>
                      </div>
                      <div fxLayout="row" fxLayoutAlign="space-between center">
                        <div fxLayout="row" fxLayoutAlign="start" fxFlex="100">
                          <div class="mat_fld_box_in" fxFlex="23.2770" >
                            <div class="mt-cust-fd" fxFlex="1 1 100%">
                              <mat-form-field appearance="fill" class="example-full-width">
                               
                                  <mat-label>Enter SAP Customer Code</mat-label>
                                  <!-- <input matInput [(ngModel)]="_obfservices.obfmodel._sap_customer_code" [ngModelOptions]="{standalone: true}" placeholder="SAP Customer Code" /> -->
                                  <input matInput type="text" formControlName="Sapcustomercode"  (change)="fetchcustomercode()" placeholder="SAP Customer Code" />
                                  <mat-error *ngIf="_obfservices.ObfCreateForm.controls.Sapcustomercode.errors?.invalidnumber">
                                    Only Numbers are allowed
                                  </mat-error>
                                  <mat-error *ngIf="_obfservices.ObfCreateForm.controls.Sapcustomercode.errors?.Sionumberinvalid">
                                    SAP Customer Code length must be <strong>8 digits</strong>
                                  </mat-error>
                              </mat-form-field>
                            </div>
                          </div>
                          <div class="mat_fld_box_in" fxFlex="56.5">
                            <div class="mt-cust-fd" fxFlex="1 1 100%">
                              <mat-form-field appearance="fill" class="example-full-width">
                                <mat-label>Enter SAP IO Number</mat-label>
                    <mat-chip-list #chipList >
                      <mat-chip *ngFor="let sapio of _obfservices.obfmodel.sapio" style="background-color:#afcaff;" [selectable]="selectable"
                               [removable]="removable" (removed)="remove(sapio)">
                        {{sapio._Cust_SAP_IO_Number}}
                        <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                      </mat-chip>
                      <input placeholder="SAP IO ..." 
                      type="text"
                      formControlName="Sapio"
                      [matChipInputFor]="chipList"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                      [matChipInputAddOnBlur]="addOnBlur"
                      (matChipInputTokenEnd)="add($event)">
                    </mat-chip-list>
                    <mat-error *ngIf="_obfservices.ObfCreateForm.controls.Sapio.errors?.Sionumberinvalid">
                      SAP IO Number length must be <strong>8 digits</strong>
                    </mat-error>
                    <mat-error *ngIf="_obfservices.ObfCreateForm.controls.Sapio.errors?.invalidnumber">
                      Only numbers are allowed
                    </mat-error>
                              </mat-form-field>
                              
                            </div>
                          </div>
                        </div>
                     
                      </div>
                      <div fxLayout="row" fxLayoutAlign="space-between center">
                        <div fxLayout="row" fxLayoutAlign="start" fxFlex="100">
                          
                          <div class="mat_fld_box_in" fxFlex="23.2770" >
                            <div class="mt-cust-fd" fxFlex="1 1 100%">
                              <div class="mat_exp_title" >Comments </div>
                            </div>
                          </div>
                        </div>
                        </div>
                        <div fxLayout="row" fxLayoutAlign="space-between center" >
                          <div fxLayout="row" fxLayoutAlign="start" fxFlex="100">
                            
                            <div class="mat_fld_box_in" fxFlex="23.2770" >
                              
                              <div class="mt-cust-fd-com" fxFlex="1 1 100%" style="    background: #e5eeff;">
                                <mat-form-field class="example-full-width" appearance="fill">
                                  <mat-label>Leave a comment</mat-label>
                                  <textarea matInput formControlName="comments" (change)="SavetoModel()"></textarea>
                                  <mat-error *ngIf="_obfservices.ObfCreateForm.controls.comments.errors?.invalidservices">
                                    <strong>Special Characters</strong> are not allowed
                                  </mat-error>
                                </mat-form-field>
                                
                              </div>
                            </div>
                          </div>
                          </div>
                     
                      <!-- <div fxFlex="auto " class="mat_view_comment">
                        <div class="mat_previe_box">
                          <div class="prev_dis">
                            Comments 
                           </div>
                           <div class="mat_comment_box">
                            <mat-form-field floatPlaceholder="never" class="example-full-width" style="background: #e5eeff;">
                                
                                  <textarea matInput formControlName="comments" placeholder="Leave a comment" (change)="SavetoModel()" style="background: #e5eeff;" ></textarea>
                                </mat-form-field>
                           </div>
                        </div>
                      </div>  -->
                      <div class="mat_exp_fot" fxLayout="row" fxLayoutAlign="space-between center" style="margin-top: 10px;">
                        <div class="mat_fot_drf">
                          <!-- <button mat-flat-button class="creat_bt mat_fot_bt" [disabled]="_obfservices.ObfCreateForm.invalid || this.isEditObf" (click)="Saveasdraft('details')">SAVE AS DRAFT</button> -->
                          <!-- <button mat-flat-button class="creat_bt mat_fot_bt" *ngIf="!isEditObf" [disabled]="!uploadnotdisabled"  (click)="Saveasdraft('details')">SAVE AS DRAFT</button> -->
                          <button mat-flat-button class="creat_bt mat_fot_bt"  [disabled]="!uploadnotdisabled"  (click)="Saveasdraft('details')">SAVE AS DRAFT</button>
                        </div>
                        <div class="mat_fot_drf" >
                          <button mat-flat-button class="creat_bt mat_fot_bt" class="creat_bt mat_fot_bt" (click)="prevStep('details')">GO BACK</button>
                          <button mat-flat-button class="creat_bt cu_width"  [disabled]="_obfservices.ObfCreateForm.invalid" (click)="nextStep('preview')">
                            NEXT
                          </button>
                        </div>
                        
                          </div>
                    </div>
                  </div>
                  
          
                 
    
   
                </mat-expansion-panel>
                <mat-expansion-panel [disabled]="true"  [expanded]="step === 2" (opened)="setStep(2)">
                  <mat-expansion-panel-header collapsedHeight="50px" expandedHeight="50px">
                  <mat-panel-title>
                    3/3 {{this.isppl == false ?'Preview OBF':'Preview PPL'}} <span class="is_done" [class.is_done_not]="!uploadnotdisabled || detailstickdisabled" ><img src="assets/images/active_tick.png" style="display: inline-block;
                      margin-left: 55px;"></span>
                  </mat-panel-title>
  
                  </mat-expansion-panel-header>
                  <div class="mat_exp_wrp">
                    <div fxLayout="row wrap" fxLayoutAlign=" start"  class="mat_fld_box_wrp">
                      <div class="mat_previe_box">
                         <div class="prev_tit">
                          Opportunity ID
                         </div>
                         <div class="prev_dis">
                          {{ _obfservices.obfmodel._opportunity_id}}
                         </div>
                      </div>
                      <div class="mat_previe_box">
                        <div class="prev_tit">
                          Project Name
                        </div>
                        <div class="prev_dis">
                          {{_obfservices.obfmodel._dh_project_name}}
                        </div>
                     </div>
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        Customer Name
                      </div>
                      <div class="prev_dis">
                        {{_obfservices.obfmodel._customer_name}}
                      </div>
                    </div>
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        Project Type
                      </div>
                      <div class="prev_dis">
                        {{projecttype}}
                      </div>
                   </div>
                  
                   <div class="mat_previe_box">
                    <div class="prev_tit">
                      Created On
                    </div>
                    <div class="prev_dis">
                      {{this.today | date}}
                    </div>
                 </div>
                 <div class="mat_previe_box">
                  <div class="prev_tit">
                    Created BY
                  </div>
                  <div class="prev_dis">
                    {{User_name}}
                  </div>
               </div>
               <div class="mat_previe_box">
                <div class="prev_tit">
                  Vertical 
                </div>
                <div class="prev_dis">
                  {{_obfservices.ObfCreateForm.get('Vertical').value}}
                </div>
             </div>
                
               <div class="mat_previe_box">
                <div class="prev_tit">
                  Sector
                </div>
                <div class="prev_dis">
                  {{this.visiblesector}}
                </div>
             </div>
            
             <div class="mat_previe_box">
              <div class="prev_tit">
                Sub Sector
              </div>
              <div class="prev_dis">
               {{this.visiblesubsector}}
              </div>
           </div>
           <div class="mat_previe_box">
            <div class="prev_tit">
              Project Primary Location / State
            </div>
            <div class="prev_dis">
              {{_obfservices.obfmodel._dh_location}}
            </div>
         </div>
           <!-- <div class="mat_previe_box">
            <div class="prev_tit">
              Vertical Head
            </div>
            <div class="prev_dis">
              {{_obfservices.ObfCreateForm.get('Verticalhead').value}}
            </div>
          </div> -->
      
         
        
      
                      </div>
                      <div fxLayout="row wrap" fxLayoutAlign=" start"  class="mat_fld_box_wrp prm_mat_fld_box_wrp">
                        <div class="mat_previe_box">
                          <div class="prev_tit">
                            Total Revenue <br>
                            ₹ Cr
                          </div>
                          <div class="prev_dis">
                            {{_obfservices.obfmodel._total_revenue}}
                          </div>
                       </div>
                       <div class="mat_previe_box">
                        <div class="prev_tit">
                          Total Cost <br>₹ Cr
                        </div>
                        <div class="prev_dis">
                          {{_obfservices.obfmodel._total_cost}}
                        </div>
                     </div>
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        Capex <br>₹ Cr 
                      </div>
                      <div class="prev_dis">
                        {{_obfservices.obfmodel._capex}}
                      </div>
                   </div>
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        Total Margin 
                      </div>
                      <div class="prev_dis">
                        {{_obfservices.obfmodel._total_margin}} %
                      </div>
                   </div>
                   <div class="mat_previe_box">
                    <div class="prev_tit">
                      Payment Terms
                    </div>
                    <div class="prev_dis">
                      {{_obfservices.obfmodel._payment_terms}} Days
                    </div>
                  </div>
                   <div class="mat_previe_box">
                    <div class="prev_tit">
                      Total Project Life 
                    </div>
                    <div class="prev_dis">
                      {{_obfservices.obfmodel._total_project_life}}
                    </div>
                 </div>
               
               <div class="mat_previe_box">
                <div class="prev_tit">
                  EBT % 
                </div>
                <div class="prev_dis">
                  {{_obfservices.obfmodel._ebt}} %
                </div>
             </div>
             <div class="mat_previe_box">
              <div class="prev_tit">
                IRR %  <br> (Surplus Cash)
              </div>
              <div class="prev_dis">
                {{_obfservices.obfmodel._irr_surplus_cash}} %
              </div>
           </div>
           <div class="mat_previe_box">
            <div class="prev_tit">
              IRR %  <br> (Borrowed Fund)
            </div>
            <div class="prev_dis">
              {{_obfservices.obfmodel._irr_borrowed_fund}} %
            </div>
          </div>
        
          
                      </div>
                      <div fxLayout="row" fxLayoutAlign="space-between start"  class="mat_fld_box_wrp">
                       <div fxFlex="auto " class="mat_view_cont">
                        <div class="mat_previe_box">
                          <div class="prev_tit">
                            Solution Category
                          </div>
                          <div class="prev_dis">
                          {{this.servicecate}}
                          </div>
                       </div> 
                       <div class="mat_previe_box">
                        <div class="prev_tit">
                          Type of Service/Solution Category
                        </div>
                        <div class="prev_dis">
                        
                           <div *ngIf="(this.service.length > 60)">
                            {{(ServiceMore) ? (this.service) : (this.service) | slice:0:50 }}  
                              <a href="javascript:;" *ngIf="!ServiceMore" (click)="ServiceMore=true"> More...</a>
                              <a href="javascript:;" *ngIf="ServiceMore" (click)="ServiceMore=false">less...</a>
                           </div>
                           <div *ngIf="(this.service.length < 60)">
                            {{(this.service)}}  
                           </div>
                        </div>
                     </div> 
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        Project Brief 
                      </div>
                      <div class="prev_dis">
                        {{(BrifreadMore) ? (_obfservices.obfmodel._dh_desc) : (_obfservices.obfmodel._dh_desc) | slice:0:50 }}  
                        <a href="javascript:;" *ngIf="!BrifreadMore" (click)="BrifreadMore=true"> More...</a>
                        <a href="javascript:;" *ngIf="BrifreadMore" (click)="BrifreadMore=false">less...</a>
                      </div>
                   </div> 
                   <div class="mat_previe_box">
                    <div class="prev_tit">
                      SAP IO Number
                    </div>
                    <div class="prev_dis">
                      <div class="sap_io_wr" >
                        {{this.SAPIONum }}  
                        <!-- {{(SAPNumMore) ? (this.SAPIONum) : (this.SAPIONum) | slice:0:50 }}   -->
                        <!-- <a href="javascript:;" *ngIf="!SAPNumMore" (click)="SAPNumMore=true"> More...</a>
                        <a href="javascript:;" *ngIf="SAPNumMore" (click)="SAPNumMore=false">less...</a> -->
                        </div>
                        
                      
                    </div>
                 </div>
                 <div class="mat_previe_box">
                  <div class="prev_tit">
                    SAP Customer Code
                  </div>
                  <div class="prev_dis">
                    
                    {{this._obfservices.obfmodel._sap_customer_code}}
                  </div>
               </div>
                       </div>
                       <div fxFlex="auto " class="mat_view_cont">
                        <div class="mat_previe_box">
                          <div class="prev_tit">
                            Assumption & Risk
                          </div>
                          <div class="prev_dis" >
                            {{(readMore) ? (_obfservices.obfmodel._assumptions_and_risks) : (_obfservices.obfmodel._assumptions_and_risks) | slice:0:50 }}  
                            <a href="javascript:;" *ngIf="!readMore" (click)="readMore=true">More...</a>
                            <a href="javascript:;" *ngIf="readMore" (click)="readMore=false">less...</a>
                          </div>
                       </div>
                      
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        Payment Terms Description
                      </div>
                      <!-- <div class="prev_dis">
                        {{ (_obfservices.ObfCreateForm.get('Payment_Terms_description').value)  }}  
                    
                       </div> -->
                       <div class="prev_dis"  *ngIf="(_obfservices.ObfCreateForm.get('Payment_Terms_description').value.length > 20)">
                            
                        {{(PaymentreadMore) ? (_obfservices.ObfCreateForm.get('Payment_Terms_description').value) : (_obfservices.ObfCreateForm.get('Payment_Terms_description').value) | slice:0:50 }}  
                        <a href="javascript:;" *ngIf="!PaymentreadMore" (click)="PaymentreadMore=true">More...</a>
                        <a href="javascript:;" *ngIf="PaymentreadMore" (click)="PaymentreadMore=false">less...</a>
                      </div>
                      <div *ngIf="(_obfservices.ObfCreateForm.get('Payment_Terms_description').value.length< 20)">
                        {{ (_obfservices.ObfCreateForm.get('Payment_Terms_description').value)  }}  
                       </div>
                   </div>
                  
                   
                   <div class="mat_previe_box">
                    <div class="prev_tit">
                      LOI/PO
                    </div>
                    <div class="prev_dis">
                      {{_obfservices.ObfCreateForm.get('Loipo').value}}
                    </div>
                 </div>
 </div>
 <div fxFlex="auto " class="mat_view_cont">
                      <div class="mat_previe_box">
                        
                        
                        <div class="prev_tit">
                          Comments
                        </div>
                        <div class="prev_dis">
                          {{this._obfservices.ObfCreateForm.get("comments").value}}
                        </div>
                     </div>
                    </div>
                     
                        
                       
                        
                        </div>
                        <div fxLayout="row" fxLayoutAlign="space-between start"  class="mat_fld_box_wrp con_dwn_wrp">
                          <div fxFlex="auto "  fxLayoutAlign="space-between center" class="mat_dwn_lod_con" >
                            <div class="dwn_con_wr">
                              <img  src="assets/images/dwn-load-file.png">
                              <span><a [href]="sanitize(this._obfservices.ObfCreateForm.get('coversheet').value)" target="_blank" >{{isppl?"PPL Sheet":"OBF Sheet"}}</a></span>
                            </div>
                            <div class="dwn_con_wr"><img (click)="downloadCoversheet($event)" src="assets/images/dwn_fil_icon.png"></div>
                            </div>
                            <div fxFlex="auto "  fxLayoutAlign="space-between center" class="mat_dwn_lod_con" [class.disabledsupporting]="disableSupporting">
                              <div class="dwn_con_wr">
                                <img src="assets/images/dwn-load-file.png">
                                <span>
                                  <a  (click)="downloaddocument($event)"  target="_blank" >Supporting Document</a></span>
                              </div>
                              <div class="dwn_con_wr"><img (click)="downloaddocument($event)"  src="assets/images/dwn_fil_icon.png"></div>
                              </div>
                              <div fxFlex="auto " fxLayoutAlign="space-between center" class="mat_dwn_lod_con" [class.disabledLOIPO]="disableLOIPO">
                                <div class="dwn_con_wr">
                                  <img  src="assets/images/dwn-load-file.png">
                                  <span ><a (click)="downloadLOIp($event)"  target="_blank" >LOI/PO/Agreement</a></span>
                                </div>
                                <div class="dwn_con_wr" ><img (click)="downloadLOIp($event)" src="assets/images/dwn_fil_icon.png" ></div>
                              </div>
                                <!-- <a [href]="sanitize(supportdocpath)" target="_blank" ></a> -->
                                
                            </div>
                         
                            <div  *ngIf="reinitiateobf"   class="mat_exp_title">Previous {{isppl?(initiateppl?'OBF':'PPL'):'OBF'}} (v{{_obfservices.editObfObject._version_name}}) </div>
                            <div  *ngIf="this.editorcreateobfstring.trim() == 'Edit PPL'"   class="mat_exp_title">Previous OBF (v{{_obfservices.editObfObject._version_name}}) </div>
                            <div fxLayout="row wrap" fxLayoutAlign=" start"  *ngIf="reinitiateobf || (this.editorcreateobfstring.trim() == 'Edit PPL')"    class="mat_fld_box_wrp prm_mat_fld_box_wrp prm_mat_fld_box_wrp_prv">
                              <div class="mat_previe_box">
                                <div class="prev_tit">
                                  Total Revenue <br>₹ Cr 
                                </div>
                                <div class="prev_dis">
                                  {{_obfservices.editObfObject._total_revenue}}
                                </div>
                             </div>
                             <div class="mat_previe_box">
                              <div class="prev_tit">
                                Total Cost<br> ₹ Cr 
                              </div>
                              <div class="prev_dis">
                                {{_obfservices.editObfObject._total_cost}}
                              </div>
                           </div>
                           <div class="mat_previe_box">
                            <div class="prev_tit">
                              Capex ₹ Cr 
                            </div>
                            <div class="prev_dis">
                              {{_obfservices.editObfObject._capex}}
                            </div>
                         </div>
                           <div class="mat_previe_box">
                            <div class="prev_tit">
                              Total Margin
                            </div>
                            <div class="prev_dis">
                              {{_obfservices.editObfObject._total_margin}}
                            </div>
                         </div>
                         <div class="mat_previe_box">
                          <div class="prev_tit">
                            Payment Terms  
                          </div>
                          <div class="prev_dis">
                            {{_obfservices.editObfObject._payment_terms}} Days
                          </div>
                       </div>
                         <div class="mat_previe_box">
                          <div class="prev_tit">
                            Total Project Life
                          </div>
                          <div class="prev_dis">
                            {{_obfservices.editObfObject._total_project_life}}
                          </div>
                       </div>
                       <div class="mat_previe_box">
                        <div class="prev_tit">
                          EBT % 
                        </div>
                        <div class="prev_dis">
                          {{_obfservices.editObfObject._ebt}}
                        </div>
                     </div>
                       <div class="mat_previe_box">
                        <div class="prev_tit">
                          IRR % <br/>(Surplus Cash)
                        </div>
                        <div class="prev_dis">
                          {{_obfservices.editObfObject._irr_surplus_cash}}
                        </div>
                     </div>
                    
                 
                 <div class="mat_previe_box">
                  <div class="prev_tit">
                    IRR % <br> (Borrowed Fund)  
                  </div>
                  <div class="prev_dis">
                    {{_obfservices.editObfObject._irr_borrowed_fund}}
                  </div>
               </div>
              
                
                     
                             
                            </div>
                              
                            <div fxLayout="column" fxLayoutAlign=" none"  class="mat_fld_box_wrp">
                            <div class="mat_exp_fot" fxLayout="row" fxLayoutAlign="space-between center">
                              <div class="mat_fot_drf" >
                                <!-- <button mat-flat-button class="creat_bt mat_fot_bt">SAVE AS DRAFT</button> -->
                              </div>
                              <div class="mat_fot_drf" >
                                <button mat-flat-button class="creat_bt mat_fot_bt" (click)="prevStep('details')">GO BACK</button>
                                <button mat-flat-button class="creat_bt cu_width" (click)="FinalSubmit()">
                                  SUBMIT
                                </button>
                              </div>
                            </div>
                                </div>
                              
                  </div>

              
                    <!-- &nbsp;
                    <div style="display: block;float: right;">
                      <div  class="sb_buttion" (click)="EditOBF()"><button>Edit</button></div>
                      <div  class="sb_buttion" (click)="FinalSubmit()"><button>Submit</button></div>
                      </div> -->
                </mat-expansion-panel>
              </mat-accordion>
              
              
      </div>
   </div>
  </form>