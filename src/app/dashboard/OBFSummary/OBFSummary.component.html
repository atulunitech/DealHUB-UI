
<div fxLayout="row" fxLayoutAlign="space-between center"  class="filter_cont creat_bof_con" >
    <div fxLayout="row" fxLayoutAlign="start center" class="creat_obf_tit">
        <div class="back_rout" routerLink="/DealHUB/dashboard"><img src="assets/images/arrow_icon.png"> Back</div>
    <div class="com_title conm_title_obf">OBF Summary</div>
</div>
<div>
    <div fxLayout="row" fxLayoutAlign="start center" class="creat_obf_tit">
      <div class="back_rout" routerLink="/DealHUB/dashboard">Close</div>
    </div>
  </div>
</div>
<div  fxLayout="column" fxLayoutAlign=" none"  class="filter_cont obf_form_cont">
    <div class="cust-accor">
        <mat-accordion>
            <mat-expansion-panel  [expanded]="step === 0" >
                <mat-expansion-panel-header collapsedHeight="50px" expandedHeight="50px">
                    <mat-panel-title>
                        OBF Summary
                    </mat-panel-title>
                   
                  </mat-expansion-panel-header>
                  <form [formGroup]="obfsummaryform">
                  <div class="mat_exp_wrp">
                    <div fxLayout="row wrap" fxLayoutAlign=" start"  class="mat_fld_box_wrp">
                      <div class="mat_previe_box">
                         <div class="prev_tit">
                          Opportunity ID
                         </div>
                         <div class="prev_dis">
                          {{_obfservices.obfsummarymodel.uploadDetails[0].opportunity_id}}
                         </div>
                      </div>
                      <div class="mat_previe_box">
                        <div class="prev_tit">
                          Project Name
                        </div>
                        <div class="prev_dis">
                          {{_obfservices.obfsummarymodel.uploadDetails[0].dh_project_name}}
                        </div>
                     </div>
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        SAP IO Number
                      </div>
                      <div class="prev_dis">
                        1234
                      </div>
                   </div>
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        SAP Customer Code
                      </div>
                      <div class="prev_dis">
                        12345,6789
                      </div>
                   </div>
                   <div class="mat_previe_box">
                    <div class="prev_tit">
                      Created On
                    </div>
                    <div class="prev_dis">
                      {{_obfservices.obfsummarymodel.uploadDetails[0].created_on | date}} 
                    </div>
                 </div>
                 <div class="mat_previe_box">
                  <div class="prev_tit">
                    Project Primary Location / State
                  </div>
                  <div class="prev_dis">
                    {{_obfservices.obfsummarymodel.uploadDetails[0].dh_location}} 
                  </div>
               </div>
               <div class="mat_previe_box">
                <div class="prev_tit">
                  Sector
                </div>
                <div class="prev_dis">
                  {{_obfservices.obfsummarymodel.uploadDetails[0].sector_name}} 
                </div>
             </div>
            
             <div class="mat_previe_box">
              <div class="prev_tit">
                Sub Sector
              </div>
              <div class="prev_dis">
                {{_obfservices.obfsummarymodel.uploadDetails[0].subsector_name}} 
              </div>
           </div>
           <div class="mat_previe_box">
            <div class="prev_tit">
              Version_name
            </div>
            <div class="prev_dis">
              {{_obfservices.obfsummarymodel.uploadDetails[0]. Version_name}} 
            </div>
         </div>
          
           <div class="mat_previe_box">
            <div class="prev_tit">
              Vertical 
            </div>
            <div class="prev_dis">
              {{_obfservices.obfsummarymodel.uploadDetails[0].Vertical_name}} 
            </div>
         </div>
           <div class="mat_previe_box">
            <div class="prev_tit">
              Vertical Head
            </div>
            <div class="prev_dis">
              {{_obfservices.obfsummarymodel.uploadDetails[0].VerticalHeadName}} 
            </div>
          </div>
          <div class="mat_previe_box">
            <div class="prev_tit">
              Customer Name
            </div>
            <div class="prev_dis">
              {{_obfservices.obfsummarymodel.uploadDetails[0].customer_name}} 
            </div>
          </div>
           
                      </div>
                      <div fxLayout="row wrap" fxLayoutAlign=" start"  class="mat_fld_box_wrp prm_mat_fld_box_wrp">
                        <div class="mat_previe_box">
                          <div class="prev_tit">
                            Total Revenue <br>
                            ₹ Cr
                          </div>
                          <div class="prev_dis">
                            {{_obfservices.obfsummarymodel.uploadDetails[0].total_revenue}} 
                          </div>
                       </div>
                       <div class="mat_previe_box">
                        <div class="prev_tit">
                          Total Cost <br>₹ Cr
                        </div>
                        <div class="prev_dis">
                          {{_obfservices.obfsummarymodel.uploadDetails[0].total_cost}} 
                        </div>
                     </div>
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        Total Margin 
                      </div>
                      <div class="prev_dis">
                        {{_obfservices.obfsummarymodel.uploadDetails[0].total_margin}}  %
                      </div>
                   </div>
                   <div class="mat_previe_box">
                    <div class="prev_tit">
                      Total Project Life 
                    </div>
                    <div class="prev_dis">
                      {{_obfservices.obfsummarymodel.uploadDetails[0].total_project_life}}  Days
                    </div>
                 </div>
                 <div class="mat_previe_box">
                  <div class="prev_tit">
                    Capex <br>₹ Cr 
                  </div>
                  <div class="prev_dis">
                    {{_obfservices.obfsummarymodel.uploadDetails[0].capex}}
                  </div>
               </div>
               <div class="mat_previe_box">
                <div class="prev_tit">
                  EBT % 
                </div>
                <div class="prev_dis">
                  {{_obfservices.obfsummarymodel.uploadDetails[0].ebt}} %
                </div>
             </div>
             <div class="mat_previe_box">
              <div class="prev_tit">
                IRR % Surplus Cash
              </div>
              <div class="prev_dis">
                {{_obfservices.obfsummarymodel.uploadDetails[0].irr_surplus_cash}} %
              </div>
           </div>
           <div class="mat_previe_box">
            <div class="prev_tit">
              IRR % Borrowed <br>Fund
            </div>
            <div class="prev_dis">
              {{_obfservices.obfsummarymodel.uploadDetails[0].irr_borrowed_fund}} %
            </div>
          </div>
          <div class="mat_previe_box">
            <div class="prev_tit">
              Payment Terms
            </div>
            <div class="prev_dis">
              {{_obfservices.obfsummarymodel.uploadDetails[0].payment_terms}}  Days
            </div>
          </div>
          
                      </div>
                      <div fxLayout="row" fxLayoutAlign="space-between start"  class="mat_fld_box_wrp">
                       <div fxFlex="auto " class="mat_view_cont">
                        <div class="mat_previe_box">
                          <div class="prev_tit">
                            Solution Category
                          </div>
                          <div class="prev_dis">
                            {{_obfservices.obfsummarymodel.uploadDetails[0].solutioncategory_name}}
                       
                          </div>
                       </div> 
                       <div class="mat_previe_box">
                        <div class="prev_tit">
                          Type of Service/Solution Category
                        </div>
                        <div class="prev_dis">
                          <div>
                        {{service}}
                      
                           </div>
                        </div>
                     </div> 
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        Project Brief 
                      </div>
                      <div class="prev_dis">
                       {{(BrifreadMore) ? (_obfservices.obfsummarymodel.uploadDetails[0].dh_desc) : (_obfservices.obfsummarymodel.uploadDetails[0].dh_desc) | slice:0:50 }}  
                        <a href="javascript:;" *ngIf="!BrifreadMore" (click)="BrifreadMore=true"> More...</a>
                        <a href="javascript:;" *ngIf="BrifreadMore" (click)="BrifreadMore=false">less...</a>
                      </div>
                   </div> 
                       </div>
                       <div fxFlex="auto " class="mat_view_cont">
                        <div class="mat_previe_box">
                          <div class="prev_tit">
                            Assumption & Risk
                          </div>
                          <div class="prev_dis">
                            
                            {{(readMore) ? (_obfservices.obfsummarymodel.uploadDetails[0].assumptions_and_risks) : (_obfservices.obfsummarymodel.uploadDetails[0].assumptions_and_risks) | slice:0:50 }}  
                            <a href="javascript:;" *ngIf="!readMore" (click)="readMore=true">More...</a>
                            <a href="javascript:;" *ngIf="readMore" (click)="readMore=false">less...</a>
                          </div>
                       </div>
                      
                     <div class="mat_previe_box">
                      <div class="prev_tit">
                        Payment Terms Description
                      </div>
                      <div class="prev_dis">
                        {{_obfservices.obfsummarymodel.uploadDetails[0].payment_term_desc}}
                         </div>
                   </div>
                   <div class="mat_previe_box">
                    <div class="prev_tit">
                      Project Date
                    </div>
                    <div class="prev_dis">  
                      {{_obfservices.obfsummarymodel.uploadDetails[0].created_on | date}} 
                     </div>
                 </div>
                   
                   <div class="mat_previe_box">
                    <div class="prev_tit">
                      LOI/Po
                    </div>
                    <div class="prev_dis">
                    
                      {{_obfservices.obfsummarymodel.uploadDetails[0].Loi_po_Details}} 
                      
                    </div>
                 </div>
                 <div class="mat_previe_box" >
                  <div class="prev_tit">
                  Workflow Indicator
                  </div>
                  <div class="prev_dis" *ngIf="this.role_name == 'VSH'">
                    <mat-slide-toggle color="primary">Margin Exception Requested</mat-slide-toggle>
                  </div>
                  <div class="prev_dis"  *ngIf="this.role_name == 'PH'">
                    <mat-slide-toggle color="primary">Exception case-CFO approval</mat-slide-toggle>
                  </div>
                  <div class="prev_dis"  *ngIf="this.role_name == 'PH'">
                    <mat-slide-toggle color="primary">Exception case-CEO approval</mat-slide-toggle>
                  </div>
               </div>

                      </div>
                      
                 <div fxFlex="auto " class="mat_view_comment">
                  <div class="mat_previe_box">
                    <div class="prev_dis">
                      Comments 
                     </div>
                     <div class="mat_comment_box">
                     <div style="height: 200px;overflow-y: scroll;">
                    <div *ngFor="let details of _obfservices.obfsummarymodel.CommentDetails">
                      <div>{{details.Fullname}}({{details.Role_name}})</div>
                      <div>{{details.Status}}<br/>{{details.dh_comment}}</div>
                      <div>Version:{{details.Version_name}} <br/>{{details.commented_on | date}}</div>
                      
                    </div>  </div>
                       
                      <mat-form-field class="example-full-width" >
                         <mat-label>Leave a comment</mat-label>
                        <!-- <textarea matInput formControlName="comments"></textarea> -->
                        <input type="text" matInput formControlName="comments">
                        
                        <mat-error *ngIf="obfsummaryform.controls.comments.errors?.required">
                          Comment is <strong>required</strong>
                        </mat-error>
                      </mat-form-field>
                      <button mat-raised-button (click)="SaveComment()" color="primary">Edit</button>
                      
                     </div>
                  </div>
                </div> 
              
                    </div>
                    <div fxLayout="row" fxLayoutAlign="space-between start"  class="mat_fld_box_wrp con_dwn_wrp">
                      <div fxFlex="auto " fxLayoutAlign="space-between center" class="mat_dwn_lod_con" >
                        <div class="dwn_con_wr">
                          <img  src="assets/images/dwn-load-file.png">
                          <span><a (click)="downloadCoversheet($event)"  target="_blank" >OBF Sheet</a></span>
                        </div>
                        <div class="dwn_con_wr"><img src="assets/images/dwn_fil_icon.png"></div>
                        </div>
                        <div fxFlex="auto "  fxLayoutAlign="space-between center" class="mat_dwn_lod_con" >
                          <div class="dwn_con_wr">
                            <img src="assets/images/dwn-load-file.png">
                            <span>
                              <a  (click)="downloadsuppodocument($event)"  target="_blank" >Supporting Document</a></span>
                          </div>
                          <div class="dwn_con_wr" ><img  src="assets/images/dwn_fil_icon.png" ></div>
                          <div class="dwn_con_wr" *ngIf="this.privilege_name == 'OBF Initiator'"><img (click)="OpenDocDownload($event,'Supporting')"  src="assets/images/dwn_fil_icon.png" ></div>
                          
                          </div>
                          <div fxFlex="auto " fxLayoutAlign="space-between center" class="mat_dwn_lod_con" >
                            <div class="dwn_con_wr">
                              <img  src="assets/images/dwn-load-file.png">
                              <span ><a (click)="downloadLOIp($event)"  target="_blank" >LOI/PO/Agreement</a></span>
                            </div>
                            <div class="dwn_con_wr" ><img  src="assets/images/dwn_fil_icon.png" ></div>
                            <div class="dwn_con_wr"  *ngIf="this.privilege_name == 'OBF Initiator'"><img (click)="OpenDocDownload($event,'loipo')"  src="assets/images/dwn_fil_icon.png" ></div>
                          
                          </div>
                          <div fxFlex="auto " fxLayoutAlign="space-between center" class="mat_dwn_lod_con" >
                            <div class="dwn_con_wr">
                              <img  src="assets/images/dwn-load-file.png">
                              <span ><a (click)="downloadLOIp($event)"  target="_blank" >Final Agreement</a></span>
                            </div>
                            <div class="dwn_con_wr" ><img  src="assets/images/dwn_fil_icon.png" ></div>
                            <div class="dwn_con_wr" *ngIf="this.privilege_name == 'OBF Initiator'"><img (click)="OpenDocDownload($event,'FinalAgg')"  src="assets/images/dwn_fil_icon.png" ></div>
                          
                          </div>
                            <!-- <a [href]="sanitize(supportdocpath)" target="_blank" ></a> -->
                            
                        </div>
                 </div>
                </form>
            </mat-expansion-panel>
            <mat-expansion-panel  [expanded]="step === 1" >
                <mat-expansion-panel-header collapsedHeight="50px" expandedHeight="50px">
                    <mat-panel-title>
                        Detailed Timeline History
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <table mat-table [dataSource]="listData" class="ms_table" matSort>
                    <ng-container  matColumnDef="username">
                      <mat-header-cell *matHeaderCellDef mat-sort-header>Username</mat-header-cell>
                    <mat-cell *matCellDef="let row" >{{row.username}}</mat-cell>
                     </ng-container>
                     <ng-container  matColumnDef="TimeLine">
                      <mat-header-cell *matHeaderCellDef mat-sort-header>TimeLine</mat-header-cell>
                    <mat-cell *matCellDef="let row" >{{row.TimeLine}}</mat-cell>
                     </ng-container>
                     <ng-container  matColumnDef="currentstatus">
                      <mat-header-cell *matHeaderCellDef mat-sort-header>Status</mat-header-cell>
                    <mat-cell *matCellDef="let row" >{{row.currentstatus}}</mat-cell>
                     </ng-container>
                     <ng-container  matColumnDef="comment">
                      <mat-header-cell *matHeaderCellDef mat-sort-header>Comment</mat-header-cell>
                    <mat-cell *matCellDef="let row" >{{row.comment}}</mat-cell>
                     </ng-container>
                  
                  <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                  <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
                    </table>
            </mat-expansion-panel>
        </mat-accordion>
        </div>
        <div fxLayout="column" fxLayoutAlign=" none"  class="mat_fld_box_wrp" *ngIf="this.privilege_name != 'OBF Initiator'">
          <div class="mat_exp_fot" fxLayout="row" fxLayoutAlign="space-between center">
            <div class="mat_fot_drf" >
              <button mat-flat-button class="creat_bt mat_fot_bt" (click)="onHoldDetails()">On Hold</button>
            </div>
            <div class="mat_fot_drf" >
              <button mat-flat-button class="creat_bt mat_fot_bt" (click)="RejectDeatils()"> Rejected</button>
              <button mat-flat-button class="creat_bt" (click)="ApproveDeatils()">
                Approve
              </button>
            </div>
          </div>
              </div>
</div>

<div>
  <ng-template #callAPIDialog>
    <div fxFlex="auto " fxLayoutAlign="space-between center" class="mat_upload_box" >
      <button mat-button mat-dialog-close>Cancel</button>
      <div fxFlex="auto " class="mat_upload_in_wr">
        <div class="mat_upload_tit">
         Uploading Document
        </div>
        <ngx-dropzone class="mat_up_con" (change)="onSelect($event)" accept=".xlsx,.xls,.pdf,.jpeg,.png,.doc,.docx,.csv">
          <ngx-dropzone-label class="matUp_lable">
            <div><img src="assets/images/Group Upload.png"></div>
            <div class="drap_titl">
            Chosse or Drag & Drop
              <div class="in_titl">Or select file from your system</div>
            </div>
            
          </ngx-dropzone-label>
         
            
        </ngx-dropzone>
        <div class="bt_uplad_con">
          <div class="cr_corner"><img src="assets/images/fold_icon.png"></div>
          <button [disabled]="!(uploadDocfiles.length >0)" (click)="uploadfiles(uploadDocfiles)"  class="creat_bt" mat-flat-button>Upload</button>
        </div>
        <!-- <input [disabled]="!(coversheetfiles.length >0)" class="btn btn-primary" (click)="uploadfiles(coversheetfiles,'coversheet')" type="button" value="Upload"/> -->
        <div class="mat_upload_tit" style="margin-top: 36px;" *ngIf="uploadDocfiles.length > 0">
          Uploading: 
         </div>
        <div *ngIf="uploaddocprocess.length == 0">
          
        <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of uploadDocfiles" [removable]="true" (removed)="onRemove(uploadDocfiles,f)">
          
          <ngx-dropzone-label class="drop_lab_cs">
            <div class="doc_icon">
              <img src="assets/images/doc_icon.JPG" style="margin-right: 15px;">
            </div>
            <div class="doc_cont" *ngIf="uploaddocprocess.length == 0">
              {{ f.name }}
            </div> 
            
          </ngx-dropzone-label>
        </ngx-dropzone-preview>
      </div>
      <div *ngIf="uploaddocprocess.length > 0">
        
        <ngx-dropzone-preview class="dro_wrp" *ngFor="let f of uploaddocprocess" >
          
          <ngx-dropzone-label class="drop_lab_cs">
            <div style="background-color: #2258bf;position: absolute;width: 100%;height: 100%;top: 0;opacity: 0.5;left: 0px;" [style.width.%]="f.value"></div>
            <div class="doc_icon" >
              <img src="assets/images/doc_icon.JPG" style="margin-right: 15px;">
            </div>
            <div class="doc_cont" style="position: relative;" >
              {{ f.fileName }}
            

            </div> 
            
          </ngx-dropzone-label>
        </ngx-dropzone-preview>
      </div>
     </div>
      <div *ngIf="message.length" class="alert alert-secondary my-3" role="alert">
        <ul *ngFor="let msg of message; let i = index">
          <li>{{ msg }}</li>
        </ul>
      </div>
    </div>
  </ng-template>
</div>
